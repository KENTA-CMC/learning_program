{
  "name": "streamlit-lab",
  "image": "mcr.microsoft.com/devcontainers/python:3.11",

  "features": {
    "ghcr.io/devcontainers/features/python:1": {
      "version": "3.11",
      "installTools": true,
      "uv": "latest" // uvのインストールはFeaturesに任せる
    }
  },

  // Codespaceが起動した後に実行されるコマンド
  // ここで仮想環境の作成と依存関係のインストールを行う
  "postCreateCommand": [
    "echo \"--- Running postCreateCommand for Streamlit Lab Setup ---\"",
    "echo \"Current working directory: $(pwd)\"",
    "echo \"Checking if uv is available: $(which uv)\"",
    "if ! command -v uv &> /dev/null; then echo \"Error: uv command not found after features installation. Aborting setup.\"; exit 1; fi",
    "echo \"Creating virtual environment using uv at: ./.venv\"",
    "uv venv || { echo \"Error: uv venv failed to create virtual environment. Aborting setup.\"; exit 1; }",
    "echo \"Installing dependencies from .devcontainer/requirements.txt into ./.venv\"",
    "./.venv/bin/uv pip install -r ./.devcontainer/requirements.txt || { echo \"Error: uv pip install failed. Aborting setup.\"; exit 1; }",
    "echo \"Verifying .venv/bin contents after installation:\"",
    "ls -lF ./.venv/bin || echo \"Warning: ./.venv/bin not found after install.\"",
    "echo \"Attempting to verify streamlit installation:\"",
    "./.venv/bin/streamlit --version || { echo \"Error: Streamlit not found in ./.venv/bin after installation. This is critical.\"; exit 1; }",
    "echo \"--- postCreateCommand finished ---\""
  ],

  "remoteEnv": {
    "PATH": "${containerWorkspaceFolder}/.venv/bin:$HOME/.local/bin:${containerEnv:PATH}"
  },

  "forwardPorts": [8501],

  "customizations": {
    "vscode": {
      "extensions": ["ms-python.python", "ms-python.vscode-pylance"],
      "settings": {
        "python.pythonPath": "${containerWorkspaceFolder}/.venv/bin/python"
      }
    }
  }
}
